# features/transactions.feature
Feature: Обработка банковских транзакций с наблюдателями
  Как банковская система
  Я хочу безопасно обрабатывать транзакции
  Чтобы предотвращать мошенничество и вести логи операций

  Scenario: Успешная обработка обычной транзакции
    Given я создаю банковскую транзакцию с ID "TRX-001" от отправителя "Иванов И.И."
    And к транзакции прикреплен логгер
    And к транзакции прикреплен детектор мошенничества с порогом "100000"
    When я обрабатываю транзакцию на сумму "50000" для получателя "Петров П.П."
    Then транзакция должна быть "completed"
    And логгер должен записать информацию о транзакции
    And не должно быть предупреждения о мошенничестве

  Scenario: Обнаружение подозрительной транзакции
    Given я создаю банковскую транзакцию с ID "TRX-002" от отправителя "Сидоров С.С."
    And к транзакции прикреплен логгер
    And к транзакции прикреплен детектор мошенничества с порогом "100000"
    When я обрабатываю транзакцию на сумму "150000" для получателя "Неизвестный"
    Then транзакция должна быть "completed"
    And логгер должен записать информацию о транзакции
    And должно быть сгенерировано предупреждение о мошенничестве

  Scenario: Отмена транзакции
    Given существует обработанная транзакция
    When я отменяю транзакцию
    Then транзакция должна быть отменена
    And в логе должна быть запись об отмене

  Scenario Outline: Проверка различных сумм транзакций
    Given я создаю банковскую транзакцию с ID "<transaction_id>" от отправителя "<sender>"
    And к транзакции прикреплен логгер
    And к транзакции прикреплен детектор мошенничества с порогом "<threshold>"
    When я обрабатываю транзакцию на сумму "<amount>" для получателя "<recipient>"
    Then транзакция должна быть "completed"
    And логгер должен записать информацию о транзакции
    And <alert_status> предупреждение о мошенничестве

    Examples:
      | transaction_id | sender       | threshold | amount  | recipient     | alert_status |
      | TRX-003        | Клиент А     | 50000     | 30000   | Клиент Б      | не должно быть |
      | TRX-004        | Клиент В     | 50000     | 75000   | Клиент Г      | должно быть    |
      | TRX-005        | Клиент Д     | 100000    | 99999   | Клиент Е      | не должно быть |
      | TRX-006        | Клиент Ж     | 100000    | 100001  | Клиент З      | должно быть    |
